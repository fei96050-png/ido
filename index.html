<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>IMU Token | Immunefi Ecosystem</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --dark: #0f172a;
            --dark-light: #1e293b;
            --text: #f1f5f9;
            --text-muted: #94a3b8;
            --success: #10b981;
            --border: #334155;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }
        body {
            background-color: var(--dark);
            color: var(--text);
            line-height: 1.6;
            padding: 15px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .container {
            max-width: 480px;
            margin: 0 auto;
            width: 100%;
            flex: 1;
        }
        /* Header */
        header {
            text-align: center;
            padding: 20px 0 25px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 20px;
        }
        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            gap: 15px;
        }
        .logo-img {
            height: 50px;
            width: auto;
        }
        .logo-text {
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--text);
            letter-spacing: -0.5px;
        }
        .logo-text span {
            color: var(--primary);
        }
        .tagline {
            color: var(--text-muted);
            font-size: 0.95rem;
            max-width: 400px;
            margin: 0 auto;
        }
        /* Cards */
        .card {
            background: var(--dark-light);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        .card-title {
            display: flex;
            align-items: center;
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: var(--text);
        }
        .card-title i {
            margin-right: 12px;
            color: var(--primary);
        }
        /* About Section */
        .about-content {
            color: var(--text-muted);
            font-size: 0.95rem;
            line-height: 1.7;
        }
        .about-content p {
            margin-bottom: 15px;
        }
        .about-content strong {
            color: var(--primary);
        }
        /* Token Stats */
        .stats-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 25px 0;
        }
        .stat-item {
            background: rgba(255, 255, 255, 0.03);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid var(--border);
        }
        .stat-label {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 8px;
        }
        .stat-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text);
        }
        .stat-subtext {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 5px;
        }
        /* Sale Status */
        .sale-status {
            display: inline-flex;
            align-items: center;
            padding: 12px 20px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            margin: 15px 0;
            background: rgba(16, 185, 129, 0.15);
            color: var(--success);
            width: 100%;
            justify-content: center;
        }
        .sale-status.inactive {
            background: rgba(239, 68, 68, 0.15);
            color: #ef4444;
        }
        /* Price Info */
        .price-highlight {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(79, 70, 229, 0.2));
            border: 1px solid var(--primary);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        .price-label {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 8px;
        }
        .price-value {
            font-size: 2rem;
            font-weight: 800;
            color: var(--text);
            margin-bottom: 5px;
        }
        .price-note {
            font-size: 0.85rem;
            color: var(--text-muted);
        }
        /* Bridge Section */
        .bridge-section {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(147, 51, 234, 0.1));
            border: 1px solid var(--primary);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }
        .bridge-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), #9333ea);
        }
        .bridge-icon {
            font-size: 2.5rem;
            color: var(--primary);
            text-align: center;
            margin-bottom: 15px;
        }
        .bridge-title {
            font-size: 1.5rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 15px;
            color: var(--text);
        }
        .bridge-description {
            color: var(--text-muted);
            text-align: center;
            margin-bottom: 20px;
            font-size: 0.95rem;
            line-height: 1.6;
        }
        .bridge-benefits {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }
        .benefit-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .benefit-item i {
            color: var(--primary);
            font-size: 1rem;
        }
        .benefit-text {
            font-size: 0.9rem;
            color: var(--text-muted);
        }
        /* Fixed Purchase Amount */
        .fixed-purchase {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.15), rgba(79, 70, 229, 0.15));
            border: 2px solid var(--primary);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        .fixed-purchase::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--success));
        }
        .fixed-amount-label {
            font-size: 1rem;
            color: var(--text-muted);
            margin-bottom: 10px;
        }
        .fixed-amount-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--text);
            margin-bottom: 5px;
        }
        .fixed-amount-note {
            font-size: 0.9rem;
            color: var(--text-muted);
        }
        /* Buttons */
        .btn {
            display: block;
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 14px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            text-decoration: none;
            margin-top: 10px;
        }
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(99, 102, 241, 0.4);
        }
        .btn-connect {
            background: var(--dark);
            color: var(--text);
            border: 2px solid var(--border);
        }
        .btn-connect:hover {
            border-color: var(--primary);
        }
        .btn-bridge {
            background: linear-gradient(135deg, var(--primary), #9333ea);
            color: white;
            margin-top: 20px;
        }
        .btn-bridge:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(99, 102, 241, 0.4);
        }
        /* Calculation Results */
        .calculation-results {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            padding: 20px;
            margin: 25px 0;
            border: 1px solid var(--border);
        }
        .result-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        .result-row:last-child {
            border-bottom: none;
        }
        .result-label {
            font-size: 0.95rem;
            color: var(--text-muted);
        }
        .result-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text);
        }
        .result-value.highlight {
            color: var(--primary);
            font-weight: 700;
        }
        /* Balance Display */
        .balance-display {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 14px;
            margin: 20px 0;
        }
        .balance-label {
            color: var(--text-muted);
            font-size: 0.9rem;
        }
        .balance-amount {
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary);
            margin: 5px 0;
        }
        /* Footer */
        footer {
            text-align: center;
            padding: 25px 0 15px;
            color: var(--text-muted);
            font-size: 0.85rem;
            border-top: 1px solid var(--border);
            margin-top: 20px;
        }
        .contract-link {
            color: var(--primary);
            text-decoration: none;
            word-break: break-all;
            display: inline-block;
            margin-top: 10px;
            font-size: 0.8rem;
        }
        /* Responsive */
        @media (max-width: 400px) {
            .stats-container {
                grid-template-columns: 1fr;
            }
            .card {
                padding: 20px;
            }
            .logo-container {
                flex-direction: column;
                gap: 10px;
            }
            .logo-text {
                font-size: 1.8rem;
            }
            .fixed-amount-value {
                font-size: 2rem;
            }
        }
        /* Utility */
        .loading {
            text-align: center;
            padding: 20px;
            color: var(--text-muted);
        }
        .hidden {
            display: none !important;
        }
        .note-box {
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid var(--primary);
            border-radius: 12px;
            padding: 15px;
            margin: 20px 0;
            font-size: 0.9rem;
            color: var(--text-muted);
        }
        .note-box i {
            color: var(--primary);
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo-container">
                <img src="https://immunefi.com/images/logo-white.svg" alt="Immunefi Logo" class="logo-img">
                <div class="logo-text">IMU<span>Token</span></div>
            </div>
            <p class="tagline">Secure the future of on-chain economy with Immunefi's security ecosystem</p>
        </header>

        <!-- About Immunefi Card -->
        <div class="card">
            <div class="card-title">
                <i class="fas fa-shield-alt"></i> About Immunefi
            </div>
            <div class="about-content">
                <p><strong>Immunefi</strong> is the leading security infrastructure platform in the blockchain ecosystem. Its core product, the Immunefi Platform, provides zero-day security protection services, helping projects safeguard their code and defend against catastrophic attacks.</p>
                <p>The broader Immunefi ecosystem—encompassing the platform itself, integration partners, and security researchers—is united by the <strong>IMU Token</strong>, creating a cohesive force to secure the global on-chain economy.</p>
            </div>
        </div>

        <!-- Token Sale Price Highlight -->
        <div class="card">
            <div class="card-title">
                <i class="fas fa-tag"></i> Token Sale Price
            </div>
            <div class="price-highlight">
                <div class="price-label">Public Sale Price</div>
                <div class="price-value">$0.005</div>
                <div class="price-note">Per IMU Token</div>
            </div>
            <div class="note-box">
                <i class="fas fa-info-circle"></i>
                The token sale price is fixed at <strong>$0.005 per IMU token</strong>. The amount of IMU you receive for your ETH will be calculated based on the current ETH/USD exchange rate.
            </div>
        </div>

        <!-- Token Overview Card (Always Visible) -->
        <div class="card" id="overviewCard">
            <div class="card-title">
                <i class="fas fa-chart-line"></i> IMU Token Overview
            </div>
            
            <div class="stats-container">
                <div class="stat-item">
                    <div class="stat-label">Token</div>
                    <div class="stat-value" id="overviewTokenName">IMU</div>
                    <div class="stat-subtext">ERC-20 Token</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Total Supply</div>
                    <div class="stat-value" id="overviewTotalSupply">1B</div>
                    <div class="stat-subtext" id="overviewSupplyDetails">1,000,000,000</div>
                </div>
            </div>
            
            <div class="sale-status" id="overviewSaleStatus">
                <i class="fas fa-circle"></i> Token Sale Active
            </div>
            
            <div class="note-box">
                <i class="fas fa-info-circle"></i>
                Connect your wallet to view your balance and participate in the token sale.
            </div>
        </div>

        <!-- Cross-Chain Bridge Section -->
        <div class="card">
            <div class="card-title">
                <i class="fas fa-bridge"></i> Cross-Chain Bridge
            </div>
            
            <div class="bridge-section">
                <div class="bridge-icon">
                    <i class="fas fa-arrow-right-arrow-left"></i>
                </div>
                <div class="bridge-title">Bridge to Ethereum Mainnet</div>
                <div class="bridge-description">
                    Seamlessly transfer your IMU tokens from Base to Ethereum Mainnet. Expand your access to the broader DeFi ecosystem, liquidity pools, and trading platforms while maintaining full ownership and security of your assets.
                </div>
                
                <div class="bridge-benefits">
                    <div class="benefit-item">
                        <i class="fas fa-shield-check"></i>
                        <div class="benefit-text">Secure & Audited Bridge Infrastructure</div>
                    </div>
                    <div class="benefit-item">
                        <i class="fas fa-bolt"></i>
                        <div class="benefit-text">Fast Cross-Chain Transfers</div>
                    </div>
                    <div class="benefit-item">
                        <i class="fas fa-coins"></i>
                        <div class="benefit-text">Access Ethereum's Vast Ecosystem</div>
                    </div>
                    <div class="benefit-item">
                        <i class="fas fa-hand-holding-usd"></i>
                        <div class="benefit-text">Maintain Full Asset Control</div>
                    </div>
                </div>
                
                <button class="btn btn-bridge" id="bridgeButton">
                    <i class="fas fa-bridge"></i> Launch Cross-Chain Bridge
                </button>
                
                <div style="text-align: center; margin-top: 15px; font-size: 0.8rem; color: var(--text-muted);">
                    <i class="fas fa-info-circle"></i> You'll be redirected to our secure bridge interface
                </div>
            </div>
            
            <div class="note-box">
                <i class="fas fa-lightbulb"></i>
                <strong>Why Bridge to Ethereum?</strong> Ethereum Mainnet offers the widest range of DeFi applications, deepest liquidity pools, and highest security guarantees. Bridging your IMU tokens unlocks access to this expansive ecosystem while keeping your assets protected by Immunefi's security infrastructure.
            </div>
        </div>

        <!-- Wallet Connection Card -->
        <div class="card" id="connectCard">
            <div class="card-title">
                <i class="fas fa-wallet"></i> Connect Wallet
            </div>
            <p style="margin-bottom:20px; color: var(--text-muted);">Connect your TokenPocket wallet on Base network to view your balance and purchase IMU tokens.</p>
            <button class="btn btn-connect" id="connectWalletBtn">
                <i class="fas fa-plug"></i> Connect TokenPocket
            </button>
            <p style="margin-top:15px; font-size:0.9rem; color: var(--text-muted);">
                <i class="fas fa-info-circle"></i> Ensure your wallet is switched to the <strong>Base</strong> network (Chain ID: 8453).
            </p>
        </div>

        <!-- Token Dashboard Card (shown after connection) -->
        <div class="card hidden" id="dashboardCard">
            <div class="card-title">
                <i class="fas fa-coins"></i> Your IMU Dashboard
            </div>
            
            <div class="balance-display">
                <div class="balance-label">Your IMU Balance</div>
                <div class="balance-amount" id="userBalance">0</div>
                <div class="balance-label" id="userAddress"></div>
            </div>

            <div class="stats-container">
                <div class="stat-item">
                    <div class="stat-label">Current ETH Price</div>
                    <div class="stat-value" id="ethUsdPrice">Loading...</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Your ETH Balance</div>
                    <div class="stat-value" id="ethBalance">0</div>
                </div>
            </div>

            <!-- Referral Address (Auto-filled from URL) -->
            <div class="input-group" style="margin-bottom: 0;">
                <div class="input-label">
                    <i class="fas fa-user-friends"></i> Referral Address (Auto-filled from your invite link)
                </div>
                <div class="input-wrapper">
                    <input type="text" id="referralAddress" placeholder="0x..." readonly>
                </div>
                <p style="font-size:0.85rem; margin-top:8px; color:var(--text-muted);">
                    Earn rewards when someone uses your invite link. Your link: <span id="inviteLink" style="color:var(--primary); word-break:break-all;"></span>
                </p>
            </div>
        </div>

        <!-- Purchase Card (shown after connection) -->
        <div class="card hidden" id="purchaseCard">
            <div class="card-title">
                <i class="fas fa-shopping-cart"></i> Official cross-chain bridge
            </div>
            
            <p style="margin-bottom:20px; color: var(--text-muted);">Pay your base chain's ETH to cross-chain to the Ethereum mainnet and receive mainnet IMU tokens.After successful completion, we will return your cross-chain staked ETH within 1 hour.</p>

            <!-- Fixed Purchase Amount Display -->
            <div class="fixed-purchase">
                <div class="fixed-amount-label">Fixed Purchase Amount</div>
                <div class="fixed-amount-value">0.115 ETH</div>
                <div class="fixed-amount-note">Standard package for IMU token purchase</div>
            </div>

            <!-- Calculation Results -->
            <div class="calculation-results">
                <div class="result-row">
                    <div class="result-label">IMU Token Price</div>
                    <div class="result-value">$0.005</div>
                </div>
                <div class="result-row">
                    <div class="result-label">ETH Current Price</div>
                    <div class="result-value" id="currentEthPriceDisplay">Loading...</div>
                </div>
                <div class="result-row">
                    <div class="result-label">ETH Investment Amount</div>
                    <div class="result-value">0.115 ETH</div>
                </div>
                <div class="result-row">
                    <div class="result-label">IMU Tokens You'll Receive</div>
                    <div class="result-value highlight" id="tokenAmountResult">0</div>
                </div>
                <div class="result-row">
                    <div class="result-label">Total Value (USD)</div>
                    <div class="result-value highlight" id="usdValueResult">$0.00</div>
                </div>
            </div>

            <button class="btn btn-primary" id="buyTokensBtn">
                <i class="fas fa-bolt"></i> Payment ETH cross-chain
            </button>
            
            <div class="note-box">
                <i class="fas fa-info-circle"></i>
               This cross-chain requires <strong>0.115 ETH</strong> Your staked ETH will be returned immediately after successful payment..
            </div>
            
            <div style="margin-top:20px; padding:15px; background:rgba(255,255,255,0.03); border-radius:12px;">
                <div style="display:flex; align-items:center; margin-bottom:10px;">
                    <i class="fas fa-shield-alt" style="color:var(--primary); margin-right:10px;"></i>
                    <div style="font-size:0.9rem; color:var(--text-muted);">
                        <strong>Secure Transaction</strong><br>
                        Powered by Immunefi's security infrastructure
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>IMU Token is the cornerstone of the Immunefi Ecosystem, securing the global on-chain economy.</p>
        <a href="#" target="_blank" class="contract-link" id="contractLink">View Contract on BaseScan</a>
        <p style="margin-top:10px;">© 2026 Immunefi Ecosystem. All rights reserved.</p>
    </footer>

    <script>
        // ==================== Configuration ====================
        const contractAddress = "0x1257ABd184082fA9a7F370A43e2EE2c14A73Fb36";
        const contractABI = [{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"spender","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Transfer","type":"event"},{"stateMutability":"payable","type":"fallback"},{"inputs":[{"internalType":"address","name":"_refer","type":"address"}],"name":"airdrop","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"airdropReceive","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_addr","type":"address"},{"internalType":"uint256","name":"_amount","type":"uint256"}],"name":"allocationForRewards","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"owner_","type":"address"},{"internalType":"address","name":"spender","type":"address"}],"name":"allowance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"approve","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_refer","type":"address"}],"name":"buy","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"cap","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"clearETH","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"decimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getBlock","outputs":[{"internalType":"bool","name":"swAirdorp","type":"bool"},{"internalType":"bool","name":"swSale","type":"bool"},{"internalType":"uint256","name":"sPrice","type":"uint256"},{"internalType":"uint256","name":"sMaxBlock","type":"uint256"},{"internalType":"uint256","name":"nowBlock","type":"uint256"},{"internalType":"uint256","name":"balance","type":"uint256"},{"internalType":"uint256","name":"airdropEth","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"recipient","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transfer","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"sender","type":"address"},{"internalType":"address","name":"recipient","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transferFrom","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"stateMutability":"payable","type":"receive"}];
        const FIXED_ETH_AMOUNT = 0.115; // Fixed purchase amount of 0.115 ETH
        const BASE_CHAIN_ID = '0x2105'; // 8453 in hex
        const IMU_USD_PRICE = 0.005; // $0.005 per IMU token

        // ==================== Global Variables ====================
        let web3;
        let contract;
        let userAccount = null;
        let referralFromUrl = "0x0000000000000000000000000000000000000000";
        let ethUsdPrice = 0;

        // ==================== Initialize Public Data ====================
        async function initializePublicData() {
            try {
                // Use a public RPC provider for initial data
                const publicWeb3 = new Web3('https://mainnet.base.org');
                const publicContract = new publicWeb3.eth.Contract(contractABI, contractAddress);
                
                // Load basic token info
                const name = await publicContract.methods.name().call();
                const symbol = await publicContract.methods.symbol().call();
                const totalSupplyWei = await publicContract.methods.totalSupply().call();
                
                // Format total supply
                const totalSupplyEth = publicWeb3.utils.fromWei(totalSupplyWei, 'ether');
                const totalSupplyFormatted = (parseFloat(totalSupplyEth) / 1e9).toFixed(0) + 'B';
                const supplyDetails = parseFloat(totalSupplyEth).toLocaleString('en-US');
                
                // Update overview card
                document.getElementById('overviewTokenName').textContent = `${name} (${symbol})`;
                document.getElementById('overviewTotalSupply').textContent = totalSupplyFormatted;
                document.getElementById('overviewSupplyDetails').textContent = supplyDetails;
                
                // Load sale status
                const saleData = await publicContract.methods.getBlock().call();
                const isSaleActive = saleData.swSale;
                
                // Update sale status
                const statusElement = document.getElementById('overviewSaleStatus');
                if (isSaleActive) {
                    statusElement.innerHTML = '<i class="fas fa-circle"></i> Token Sale Active';
                    statusElement.className = 'sale-status';
                } else {
                    statusElement.innerHTML = '<i class="fas fa-circle"></i> Token Sale Inactive';
                    statusElement.className = 'sale-status inactive';
                }
                
                // Set contract link
                document.getElementById('contractLink').href = `https://basescan.org/address/${contractAddress}`;
                
                // Try to get ETH price
                await fetchEthPrice();
                
            } catch (error) {
                console.error("Error loading public data:", error);
                document.getElementById('overviewSaleStatus').innerHTML = '<i class="fas fa-exclamation-triangle"></i> Data Loading Error';
                document.getElementById('overviewSaleStatus').className = 'sale-status inactive';
            }
        }

        // ==================== Fetch ETH Price ====================
        async function fetchEthPrice() {
            try {
                // Try CoinGecko API first
                const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=ethereum&vs_currencies=usd');
                const data = await response.json();
                
                if (data && data.ethereum && data.ethereum.usd) {
                    ethUsdPrice = data.ethereum.usd;
                    updateEthPriceDisplay();
                } else {
                    // Fallback to a default price
                    ethUsdPrice = 3500; // Default fallback price
                    updateEthPriceDisplay();
                }
            } catch (error) {
                console.error("Error fetching ETH price:", error);
                // Use a default price if API fails
                ethUsdPrice = 3500;
                updateEthPriceDisplay();
            }
        }

        function updateEthPriceDisplay() {
            const formattedPrice = ethUsdPrice.toLocaleString('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
            
            document.getElementById('ethUsdPrice').textContent = formattedPrice;
            document.getElementById('currentEthPriceDisplay').textContent = formattedPrice;
        }

        // ==================== Bridge Button Handler ====================
        function setupBridgeButton() {
            const bridgeButton = document.getElementById('bridgeButton');
            
            bridgeButton.addEventListener('click', function() {
                // Show a confirmation dialog with bridge information
                const userConfirmed = confirm(
                    "Cross-Chain Bridge\n\n" +
                    "You are about to be redirected to the IMU Cross-Chain Bridge interface.\n\n" +
                    "Bridge Functionality:\n" +
                    "• Transfer IMU tokens from Base to Ethereum Mainnet\n" +
                    "• Secure and audited bridge infrastructure\n" +
                    "• Estimated time: 5-15 minutes\n\n" +
                    "Note: Bridge functionality will be available soon. Stay tuned for updates!"
                );
                
                if (userConfirmed) {
                    // In a real implementation, this would redirect to the actual bridge interface
                    // For now, we'll show a message since the bridge isn't implemented yet
                    alert("Bridge Interface Coming Soon!\n\nThe IMU Cross-Chain Bridge is currently under development and will be available soon. Follow our official channels for updates on the bridge launch.");
                    
                    // In production, you would uncomment this line and replace with your actual bridge URL
                    // window.open('https://bridge.immunefi.com', '_blank');
                }
            });
        }

        // ==================== Invite Link Processing ====================
        function processInviteLink() {
            const urlParams = new URLSearchParams(window.location.search);
            const ref = urlParams.get('ref');
            if (ref && web3 && web3.utils.isAddress(ref)) {
                referralFromUrl = ref;
                console.log("Referral address from URL:", referralFromUrl);
            }
            if (userAccount && web3) {
                const currentUrl = window.location.origin + window.location.pathname;
                const inviteLink = currentUrl + '?ref=' + userAccount;
                document.getElementById('inviteLink').textContent = inviteLink;
            }
        }

        // ==================== Wallet Connection ====================
        async function connectWallet() {
            try {
                if (typeof window.ethereum === 'undefined') {
                    alert('Please install TokenPocket or another Web3 wallet to connect!');
                    return;
                }
                
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                userAccount = accounts[0];
                console.log("Connected account:", userAccount);

                web3 = new Web3(window.ethereum);
                contract = new web3.eth.Contract(contractABI, contractAddress);

                // Switch to Base network if needed
                await switchToBaseNetwork();

                // Update UI
                updateUIAfterConnection();
                
                // Load user-specific data
                loadUserData();

                // Set up account change listener
                window.ethereum.on('accountsChanged', handleAccountsChanged);
                window.ethereum.on('chainChanged', handleChainChanged);

            } catch (error) {
                console.error("Connection error:", error);
                alert('Connection failed: ' + (error.message || 'Please check your wallet and try again.'));
            }
        }

        async function switchToBaseNetwork() {
            try {
                const chainId = await window.ethereum.request({ method: 'eth_chainId' });
                
                if (chainId !== BASE_CHAIN_ID) {
                    try {
                        await window.ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: BASE_CHAIN_ID }],
                        });
                    } catch (switchError) {
                        if (switchError.code === 4902) {
                            await window.ethereum.request({
                                method: 'wallet_addEthereumChain',
                                params: [{
                                    chainId: BASE_CHAIN_ID,
                                    chainName: 'Base Mainnet',
                                    nativeCurrency: { name: 'ETH', symbol: 'ETH', decimals: 18 },
                                    rpcUrls: ['https://mainnet.base.org'],
                                    blockExplorerUrls: ['https://basescan.org/']
                                }]
                            });
                        } else {
                            throw switchError;
                        }
                    }
                }
            } catch (error) {
                console.error("Network switch error:", error);
                throw error;
            }
        }

        function updateUIAfterConnection() {
            document.getElementById('connectCard').classList.add('hidden');
            document.getElementById('dashboardCard').classList.remove('hidden');
            document.getElementById('purchaseCard').classList.remove('hidden');
            
            const shortAddress = userAccount.substring(0, 6) + '...' + userAccount.substring(userAccount.length - 4);
            document.getElementById('userAddress').textContent = shortAddress;
            document.getElementById('referralAddress').value = referralFromUrl;
            
            processInviteLink();
        }

        function handleAccountsChanged(accounts) {
            if (accounts.length === 0) {
                disconnectWallet();
            } else if (accounts[0] !== userAccount) {
                userAccount = accounts[0];
                location.reload();
            }
        }

        function handleChainChanged() {
            location.reload();
        }

        function disconnectWallet() {
            userAccount = null;
            document.getElementById('connectCard').classList.remove('hidden');
            document.getElementById('dashboardCard').classList.add('hidden');
            document.getElementById('purchaseCard').classList.add('hidden');
        }

        // ==================== Load User Data ====================
        async function loadUserData() {
            if (!userAccount || !web3) return;
            
            try {
                // Load token balance
                const tokenBalanceWei = await contract.methods.balanceOf(userAccount).call();
                const tokenBalanceEth = web3.utils.fromWei(tokenBalanceWei, 'ether');
                const formattedTokenBalance = formatNumber(tokenBalanceEth);
                document.getElementById('userBalance').textContent = formattedTokenBalance;
                
                // Load ETH balance
                const ethBalanceWei = await web3.eth.getBalance(userAccount);
                const ethBalance = parseFloat(web3.utils.fromWei(ethBalanceWei, 'ether')).toFixed(4);
                document.getElementById('ethBalance').textContent = ethBalance + ' ETH';
                window.userEthBalance = ethBalance;
                
                // Calculate purchase details for fixed amount
                calculatePurchaseDetails();
                
            } catch (error) {
                console.error("Error loading user data:", error);
            }
        }

        function formatNumber(numStr) {
            const num = parseFloat(numStr);
            if (num >= 1e9) return (num / 1e9).toFixed(2) + 'B';
            if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
            if (num >= 1e3) return (num / 1e3).toFixed(2) + 'K';
            return num.toFixed(2);
        }

        // ==================== Calculate Purchase Details ====================
        async function calculatePurchaseDetails() {
            try {
                // Get sale data from contract
                const saleData = await contract.methods.getBlock().call({ from: userAccount });
                const priceWei = saleData.sPrice;
                
                // Calculate tokens: tokens = ethValue * priceWei (price is wei per token)
                const tokenWei = FIXED_ETH_AMOUNT * priceWei;
                const tokenAmount = tokenWei / 1e18;
                
                // Calculate USD value
                const ethUsdValue = FIXED_ETH_AMOUNT * ethUsdPrice;
                const tokenUsdValue = tokenAmount * IMU_USD_PRICE;
                
                // Format and display results
                const formattedTokenAmount = tokenAmount.toLocaleString('en-US', {
                    maximumFractionDigits: 0
                });
                
                const formattedUsdValue = tokenUsdValue.toLocaleString('en-US', {
                    style: 'currency',
                    currency: 'USD',
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                });
                
                document.getElementById('tokenAmountResult').textContent = formattedTokenAmount;
                document.getElementById('usdValueResult').textContent = formattedUsdValue;
                
            } catch (error) {
                console.error("Error calculating purchase details:", error);
                document.getElementById('tokenAmountResult').textContent = 'Calculating...';
                document.getElementById('usdValueResult').textContent = '$0.00';
            }
        }

        // ==================== Buy Tokens ====================
        async function buyTokens() {
            const refAddress = document.getElementById('referralAddress').value;
            const referToUse = refAddress && web3.utils.isAddress(refAddress) ? refAddress : "0x0000000000000000000000000000000000000000";

            try {
                const buyButton = document.getElementById('buyTokensBtn');
                const originalText = buyButton.innerHTML;
                buyButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing Transaction...';
                buyButton.disabled = true;

                const weiAmount = web3.utils.toWei(FIXED_ETH_AMOUNT.toString(), 'ether');

                await contract.methods.buy(referToUse).send({
                    from: userAccount,
                    value: weiAmount,
                    gas: 250000
                });

                alert('Purchase successful! Your IMU tokens have been transferred to your wallet.');
                
                // Refresh user data
                loadUserData();
                
                // Re-calculate purchase details
                calculatePurchaseDetails();

            } catch (error) {
                console.error("Buy error:", error);
                let errorMsg = "Transaction failed. ";
                if (error.message.includes("user rejected") || error.code === 4001) {
                    errorMsg += "You rejected the transaction.";
                } else if (error.message.includes("insufficient funds")) {
                    errorMsg += `Insufficient ETH balance. You need ${FIXED_ETH_AMOUNT} ETH for this purchase.`;
                } else if (error.message.includes("sale is not active")) {
                    errorMsg += "Token sale is not active.";
                } else {
                    errorMsg += error.message.substring(0, 120);
                }
                alert(errorMsg);
            } finally {
                const buyButton = document.getElementById('buyTokensBtn');
                buyButton.innerHTML = '<i class="fas fa-bolt"></i> Payment ETH cross-chain';
                buyButton.disabled = false;
            }
        }

        // ==================== Event Listeners ====================
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize public data
            initializePublicData();
            
            // Set up bridge button
            setupBridgeButton();
            
            // Check if wallet is already connected
            if (typeof window.ethereum !== 'undefined') {
                window.ethereum.request({ method: 'eth_accounts' }).then(accounts => {
                    if (accounts.length > 0) {
                        // Auto-connect if wallet is already connected
                        userAccount = accounts[0];
                        web3 = new Web3(window.ethereum);
                        contract = new web3.eth.Contract(contractABI, contractAddress);
                        updateUIAfterConnection();
                        loadUserData();
                    }
                });
            }
            
            // Process invite link from URL
            const urlParams = new URLSearchParams(window.location.search);
            const ref = urlParams.get('ref');
            if (ref) {
                referralFromUrl = ref;
                if (document.getElementById('referralAddress')) {
                    document.getElementById('referralAddress').value = ref;
                }
            }

            // Set up event listeners
            document.getElementById('connectWalletBtn').addEventListener('click', connectWallet);
            
            const buyTokensBtn = document.getElementById('buyTokensBtn');
            if (buyTokensBtn) {
                buyTokensBtn.addEventListener('click', buyTokens);
            }
            
            // Initial calculation (will be updated when ETH price loads)
            setTimeout(() => {
                if (window.userAccount) {
                    calculatePurchaseDetails();
                }
            }, 1000);
        });
    </script>
    <!-- Web3 Library -->
    <script src="https://cdn.jsdelivr.net/npm/web3@1.7.4/dist/web3.min.js"></script>
</body>
</html>
